#  This software shall not be used for commercial purposes, only for learning communication
#  Copyright (c) 2022-2023. All rights reserved.
import geopandas
from geopandas import GeoSeries, GeoDataFrame
from shapely import geometry
from shapely.geometry import Point, LineString, Polygon


def points2shp(list, outPath, crs="wgs84"):
    """
    根据点坐标构建面要素
    :param list: 点坐标 格式[{"lng":79.49298195561477,"lat":39.94833367080844}]
    :param outPath: 输出路径
    :param crs: 坐标系，默认为"EPSG:4326", "EPSG：2381"
    :return:
    """
    listNew = []
    if len(list) > 0:
        # 获取lon lat坐标值
        for i in range(0, len(list)):
            lon = list[i].get('lon')
            lat = list[i].get('lat')
            listNew.append(tuple((lon, lat), ))

        # 将坐标值转为面要素
        polyGeometry = geometry.Polygon(listNew)

        # 构建GeodataFrame
        dataFrame = geopandas.GeoDataFrame({'geometry': [polyGeometry]}, crs=crs)

        # 将面要素导出为shp格式
        if outPath is not None:
            dataFrame.to_file(outPath, driver='ESRI Shapefile', encoding='utf-8')
        else:
            print('路径错误')
    else:
        print('传入数据为空')
        pass

if __name__ == '__main__':
    data = [
        {"lon": 115.8061469, "lat": 40.5559326},
        {"lon": 115.8189185, "lat": 40.5510258},
        {"lon": 115.8194724, "lat": 40.5452439},
        {"lon": 115.8267593, "lat": 40.5405068},
        {"lon": 115.8310419, "lat": 40.5375141},
        {"lon": 115.8375854, "lat": 40.5213458},
        {"lon": 115.8323678, "lat": 40.5130100},
        {"lon": 115.8299225, "lat": 40.5071388},
        {"lon": 115.8249328, "lat": 40.4944007},
        {"lon": 115.8245203, "lat": 40.4931160},
        {"lon": 115.8146959, "lat": 40.4860433},
        {"lon": 115.8080771, "lat": 40.4863239},
        {"lon": 115.7954070, "lat": 40.4873670},
        {"lon": 115.7936046, "lat": 40.4874551},
        {"lon": 115.7817025, "lat": 40.4849436},
        {"lon": 115.7789876, "lat": 40.4864727},
        {"lon": 115.7758505, "lat": 40.4886073},
        {"lon": 115.7756788, "lat": 40.4912999},
        {"lon": 115.7726962, "lat": 40.4929318},
        {"lon": 115.7676751, "lat": 40.4925565},
        {"lon": 115.7618386, "lat": 40.4968154},
        {"lon": 115.7388360, "lat": 40.4973539},
        {"lon": 115.7372911, "lat": 40.4932418},
        {"lon": 115.7333643, "lat": 40.4961790},
        {"lon": 115.7294375, "lat": 40.5029505},
        {"lon": 115.7345874, "lat": 40.5100964},
        {"lon": 115.7324631, "lat": 40.5109447},
        {"lon": 115.7369906, "lat": 40.5125924},
        {"lon": 115.7375056, "lat": 40.5176168},
        {"lon": 115.7452948, "lat": 40.5284962},
        {"lon": 115.7492644, "lat": 40.5296052},
        {"lon": 115.7487709, "lat": 40.5331279},
        {"lon": 115.7461745, "lat": 40.5358188},
        {"lon": 115.7491786, "lat": 40.5389987},
        {"lon": 115.7524616, "lat": 40.5374332},
        {"lon": 115.7579977, "lat": 40.5397815},
        {"lon": 115.7594783, "lat": 40.5421622},
        {"lon": 115.7645208, "lat": 40.5473474},
        {"lon": 115.7687051, "lat": 40.5472985},
        {"lon": 115.7697136, "lat": 40.5506410},
        {"lon": 115.7826311, "lat": 40.5599011},
        {"lon": 115.7888968, "lat": 40.5604391},
        {"lon": 115.7921804, "lat": 40.5565953},
        {"lon": 115.7991778, "lat": 40.5576060},
        {"lon": 115.8048140, "lat": 40.5563275},
        {"lon": 115.7838325, "lat": 40.4866415},
        {"lon": 115.7906921, "lat": 40.4862645},
        {"lon": 115.7984534, "lat": 40.4896472},
        {"lon": 115.8043552, "lat": 40.4879775},
        {"lon": 115.8099877, "lat": 40.4882605},
        {"lon": 115.8173086, "lat": 40.4879687},
        {"lon": 115.8125177, "lat": 40.4872935},
        {"lon": 115.7994876, "lat": 40.4908913},
        {"lon": 115.8029115, "lat": 40.4880392},
        {"lon": 115.7858439, "lat": 40.4865081},
        {"lon": 115.7872525, "lat": 40.4871751},
        {"lon": 115.7888734, "lat": 40.4865318},
        {"lon": 115.7926290, "lat": 40.4868990},
        {"lon": 115.7941076, "lat": 40.4875933},
        {"lon": 115.7963321, "lat": 40.4877011},
        {"lon": 115.7972704, "lat": 40.4886428},
        {"lon": 115.8182538, "lat": 40.4883022},
        {"lon": 115.8184815, "lat": 40.4879680},
        {"lon": 115.8211954, "lat": 40.4886376},
        {"lon": 115.8233250, "lat": 40.4907067},
        {"lon": 115.8258121, "lat": 40.4948939},
        {"lon": 115.8248569, "lat": 40.4969183},
        {"lon": 115.8254331, "lat": 40.4999977},
        {"lon": 115.8268627, "lat": 40.4999768},
        {"lon": 115.8287937, "lat": 40.4998945},
        {"lon": 115.8281260, "lat": 40.5021722},
        {"lon": 115.8280834, "lat": 40.5042046},
        {"lon": 115.8295774, "lat": 40.5061794},
        {"lon": 115.8297190, "lat": 40.5084612},
        {"lon": 115.8293100, "lat": 40.5098596},
        {"lon": 115.8293938, "lat": 40.5106836},
        {"lon": 115.8306436, "lat": 40.5114552},
        {"lon": 115.8326745, "lat": 40.5119622},
        {"lon": 115.8321129, "lat": 40.5143735},
        {"lon": 115.8322389, "lat": 40.5149032},
        {"lon": 115.8327160, "lat": 40.5153684},
        {"lon": 115.8330605, "lat": 40.5163023},
        {"lon": 115.8332310, "lat": 40.5170773},
        {"lon": 115.8335607, "lat": 40.5182472},
        {"lon": 115.8338234, "lat": 40.5189610},
        {"lon": 115.8342211, "lat": 40.5198351},
        {"lon": 115.8353711, "lat": 40.5208725},
        {"lon": 115.8138398, "lat": 40.5582312},
        {"lon": 115.8365687, "lat": 40.5226057},
        {"lon": 115.8364740, "lat": 40.5240896},
        {"lon": 115.8371731, "lat": 40.5253354},
        {"lon": 115.8385217, "lat": 40.5264003},
        {"lon": 115.8393887, "lat": 40.5274815},
        {"lon": 115.8403552, "lat": 40.5290375},
        {"lon": 115.8384611, "lat": 40.5302592},
        {"lon": 115.8376265, "lat": 40.5321902},
        {"lon": 115.8377255, "lat": 40.5340612},
        {"lon": 115.8358922, "lat": 40.5349725},
        {"lon": 115.8339721, "lat": 40.5357123},
        {"lon": 115.8319938, "lat": 40.5372336},
        {"lon": 115.8279145, "lat": 40.5375809},
        {"lon": 115.8272187, "lat": 40.5382619},
        {"lon": 115.8236604, "lat": 40.5413778},
        {"lon": 115.8219003, "lat": 40.5430496},
        {"lon": 115.8197341, "lat": 40.5436145},
        {"lon": 115.8175793, "lat": 40.5547628}
    ]
    points2shp(data, './北京松山国家级自然保护区.shp')